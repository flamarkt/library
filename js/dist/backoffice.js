(()=>{var t={n:n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return t.d(o,{a:o}),o},d:(n,o)=>{for(var e in o)t.o(o,e)&&!t.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:o[e]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n);const o=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{}).app;var e=t.n(o);function i(t,n){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},i(t,n)}function r(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,i(t,n)}const a=flarum.core.compat["common/Model"];var s=t.n(a),c=function(t){function n(){for(var n,o=arguments.length,e=new Array(o),i=0;i<o;i++)e[i]=arguments[i];return(n=t.call.apply(t,[this].concat(e))||this).conversions=s().attribute("conversions"),n.title=s().attribute("title"),n.description=s().attribute("description"),n}r(n,t);var o=n.prototype;return o.conversionUrl=function(t){return this.conversions()[t]?this.conversions()[t]:this.conversions()[Object.keys(this.conversions())[0]]},o.apiEndpoint=function(){return"/flamarkt/files"+(this.exists?"/"+this.data.id:"")},n}(s());const l=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/BackofficeNav"];var f=t.n(l);const u=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/ActiveLinkButton"];var p=t.n(u);const h=((flarum.extensions["flamarkt-core"]||{}).backoffice||{})["components/ProductList"];var d=t.n(h);const b=((flarum.extensions["flamarkt-core"]||{}).backoffice||{})["pages/ProductShowPage"];var v=t.n(b);const y=((flarum.extensions["flamarkt-core"]||{}).common||{})["models/Product"];var k=t.n(y);const g=flarum.core.compat["common/extend"],x=flarum.core.compat["common/components/Button"];var w=t.n(x);const P=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/SearchInput"];var S=t.n(P);const B=flarum.core.compat["common/components/Page"];var F=t.n(B);const O=flarum.core.compat["common/utils/extractText"];var L=t.n(O);const A=flarum.core.compat["common/utils/ItemList"];var T=t.n(A);const j=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["states/AbstractListState"];var _=function(t){function n(){return t.apply(this,arguments)||this}return r(n,t),n.prototype.type=function(){return"flamarkt/files"},n}(t.n(j)());const M=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/AbstractList"];var N=t.n(M);const U=flarum.core.compat["common/components/LinkButton"];var C=t.n(U),I=function(t){function n(){return t.apply(this,arguments)||this}r(n,t);var o=n.prototype;return o.head=function(){var n=t.prototype.head.call(this);return n.add("thumbnail",m("th",e().translator.trans("flamarkt-library.backoffice.files.head.thumbnail")),20),n.add("title",m("th",e().translator.trans("flamarkt-library.backoffice.files.head.title")),10),n},o.columns=function(n){var o=t.prototype.columns.call(this,n);return o.add("thumbnail",m("td",m("img",{src:n.conversionUrl("150x150"),alt:n.title()})),20),o.add("title",m("td",n.title()),10),o},o.actions=function(n){var o=t.prototype.actions.call(this,n);return o.add("edit",C().component({className:"Button Button--icon",icon:"fas fa-pen",href:e().route("files.show",{id:n.id()})})),o},n}(N()),q=function(t){function n(){for(var n,o=arguments.length,e=new Array(o),i=0;i<o;i++)e[i]=arguments[i];return(n=t.call.apply(t,[this].concat(e))||this).list=void 0,n.uploading=!1,n}r(n,t);var o=n.prototype;return o.oninit=function(n){t.prototype.oninit.call(this,n),this.list=new _,this.list.refresh()},o.filters=function(){var t=this,n=new(T());return n.add("search",m(S(),{initialValue:"",onchange:function(n){t.list.params.q=n,t.list.refresh()},placeholder:L()(e().translator.trans("flamarkt-library.backoffice.files.searchPlaceholder"))}),50),n.add("separator",m(".BackofficeListFilters--separator"),-10),n.add("upload",m("input",{type:"file",onchange:function(n){var o=new FormData;o.append("file",n.target.files[0]),t.uploading=!0,m.redraw(),e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/flamarkt/files",serialize:function(t){return t},body:o}).then((function(n){t.uploading=!1,t.list.add(e().store.pushPayload(n)),m.redraw()})).catch((function(n){throw t.uploading=!1,m.redraw(),n}))}}),-100),n},o.view=function(){return m(".FileIndexPage",m(".container",[m(".BackofficeListFilters",this.filters().toArray()),m(I,{list:this.list})]))},n}(F());const z=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["pages/AbstractShowPage"];var D=t.n(z);const R=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/SubmitButton"];var V=t.n(R);const E=flarum.core.compat["common/components/LoadingIndicator"];var G=t.n(E),H=function(t){function n(){for(var n,o=arguments.length,e=new Array(o),i=0;i<o;i++)e[i]=arguments[i];return(n=t.call.apply(t,[this].concat(e))||this).file=null,n.dirty=!1,n.saving=!1,n.title="",n.description="",n}r(n,t);var o=n.prototype;return o.findType=function(){return"flamarkt/files"},o.show=function(t){this.file=t,this.title=t.title()||"",this.description=t.description()||"",e().setTitle(t.title()),e().setTitleCount(0)},o.view=function(){var t=this;return this.file?m("form.FileShowPage",{onsubmit:this.onsubmit.bind(this)},m(".container",[m(".Form-group",[m("label",e().translator.trans("flamarkt-library.backoffice.files.field.title")),m("input.FormControl",{type:"text",value:this.title,oninput:function(n){t.title=n.target.value,t.dirty=!0}})]),m(".Form-group",[m("label",e().translator.trans("flamarkt-library.backoffice.files.field.description")),m("textarea.FormControl",{value:this.description,oninput:function(n){t.description=n.target.value,t.dirty=!0}})]),m(".Form-group",[V().component({loading:this.saving,dirty:this.dirty,exists:this.file.exists})])])):G().component()},o.data=function(){return{title:this.title,description:this.description}},o.onsubmit=function(t){var n=this;t.preventDefault(),this.saving=!0,this.file.save(this.data()).then((function(t){n.file=t,n.saving=!1,n.dirty=!1,m.redraw()})).catch((function(t){n.saving=!1,m.redraw()}))},n}(D());const J=flarum.core.compat["common/components/Modal"];var K=t.n(J),Q=function(t){function n(){return t.apply(this,arguments)||this}return r(n,t),n.prototype.actions=function(t){var n=this,o=new(T());return o.add("select",w().component({className:"Button",icon:"fas fa-check",onclick:function(){n.attrs.onselect(t)}},"Select")),o},n}(I),W=function(t){function n(){for(var n,o=arguments.length,e=new Array(o),i=0;i<o;i++)e[i]=arguments[i];return(n=t.call.apply(t,[this].concat(e))||this).list=void 0,n}r(n,t);var o=n.prototype;return o.oninit=function(n){t.prototype.oninit.call(this,n),this.list=new _,this.list.refresh()},o.className=function(){return"FlamarktLibrarySelectionModal"},o.title=function(){return e().translator.trans("flamarkt-library.backoffice.select.title")},o.filters=function(){var t=this,n=new(T());return n.add("search",m(S(),{initialValue:"",onchange:function(n){t.list.params.q=n,t.list.refresh()},placeholder:L()(e().translator.trans("flamarkt-library.backoffice.files.searchPlaceholder"))}),50),n},o.content=function(){var t=this;return m(".Modal-body",[m(".BackofficeListFilters",this.filters().toArray()),m(Q,{state:this.list,onselect:function(n){t.attrs.onselect(n),t.hide()}})])},n}(K());e().initializers.add("flamarkt-library",(function(){e().store.models["flamarkt-files"]=c,k().prototype.thumbnail=s().hasOne("thumbnail"),e().routes["files.index"]={path:"/files",component:q},e().routes["files.show"]={path:"/files/:id",component:H},(0,g.extend)(f().prototype,"items",(function(t){t.add("library",p().component({href:e().route("files.index"),icon:"fas fa-file",activeRoutes:["files.*"]},"Library"))})),(0,g.extend)(d().prototype,"head",(function(t){t.add("thumbnail",m("th","Thumbnail"),30)})),(0,g.extend)(d().prototype,"columns",(function(t,n){var o=n.thumbnail();t.add("thumbnail",m("td",o?m("img",{src:o.conversionUrl("150x150"),alt:n.title()}):null),30)})),(0,g.extend)(v().prototype,"oninit",(function(){this.thumbnail=null})),(0,g.extend)(v().prototype,"show",(function(t,n){this.thumbnail=n.thumbnail()||null})),(0,g.extend)(v().prototype,"fields",(function(t){var n=this;t.add("thumbnail",m(".Form-group",[m("label","Thumbnail"),this.thumbnail?[m("img",{src:this.thumbnail.conversionUrl("150x150")}),w().component({className:"Button",icon:"fas fa-times",onclick:function(){n.thumbnail=null,n.dirty=!0}},"Remove")]:null,w().component({className:"Button",icon:"fas fa-file",onclick:function(){e().modal.show(W,{onselect:function(t){n.thumbnail=t,n.dirty=!0}})}},"Choose")]))})),(0,g.extend)(v().prototype,"data",(function(t){t.relationships=t.relationships||{},t.relationships.thumbnail=this.thumbnail}))}))})(),module.exports=n})();
//# sourceMappingURL=backoffice.js.map