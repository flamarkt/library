{"version":3,"file":"backoffice.js","mappings":"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","sources":["webpack://@flamarkt/library/webpack/bootstrap","webpack://@flamarkt/library/webpack/runtime/compat get default export","webpack://@flamarkt/library/webpack/runtime/define property getters","webpack://@flamarkt/library/webpack/runtime/hasOwnProperty shorthand","webpack://@flamarkt/library/webpack/runtime/make namespace object","webpack://@flamarkt/library/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@flamarkt/library/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@flamarkt/library/external root \"flarum.core.compat['common/Model']\"","webpack://@flamarkt/library/./src/common/models/File.ts","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-backoffice']||{})['backoffice']||{})['components/BackofficeNav']\"","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-backoffice']||{})['common']||{})['components/ActiveLinkButton']\"","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-core']||{})['backoffice']||{})['components/ProductList']\"","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-core']||{})['backoffice']||{})['pages/ProductShowPage']\"","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-core']||{})['common']||{})['models/Product']\"","webpack://@flamarkt/library/external root \"flarum.core.compat['common/extend']\"","webpack://@flamarkt/library/external root \"flarum.core.compat['common/components/Button']\"","webpack://@flamarkt/library/external root \"flarum.core.compat['common/components/Page']\"","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-backoffice']||{})['common']||{})['states/AbstractListState']\"","webpack://@flamarkt/library/./src/backoffice/states/FileListState.ts","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-backoffice']||{})['backoffice']||{})['components/AbstractList']\"","webpack://@flamarkt/library/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@flamarkt/library/./src/backoffice/components/FileList.ts","webpack://@flamarkt/library/./src/backoffice/pages/FileIndexPage.ts","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-backoffice']||{})['common']||{})['pages/AbstractShowPage']\"","webpack://@flamarkt/library/external root \"((flarum.extensions['flamarkt-backoffice']||{})['backoffice']||{})['components/SubmitButton']\"","webpack://@flamarkt/library/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@flamarkt/library/./src/backoffice/pages/FileShowPage.ts","webpack://@flamarkt/library/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@flamarkt/library/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@flamarkt/library/./src/backoffice/components/FileSelectList.ts","webpack://@flamarkt/library/./src/backoffice/components/FileSelectionModal.ts","webpack://@flamarkt/library/./src/backoffice/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\n\nexport default class File extends Model {\n    conversions = Model.attribute<{ [key: string]: string }>('conversions');\n    title = Model.attribute<string>('title');\n    description = Model.attribute<string>('description');\n\n    conversionUrl(name: string) {\n        if (this.conversions()[name]) {\n            return this.conversions()[name];\n        }\n\n        // Default to first conversion TODO: add logic\n        return this.conversions()[Object.keys(this.conversions())[0]];\n    }\n\n    apiEndpoint() {\n        return '/flamarkt/files' + (this.exists ? '/' + (this.data as any).id : '');\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-backoffice']||{})['backoffice']||{})['components/BackofficeNav'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-backoffice']||{})['common']||{})['components/ActiveLinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['backoffice']||{})['components/ProductList'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['backoffice']||{})['pages/ProductShowPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['common']||{})['models/Product'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Page'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-backoffice']||{})['common']||{})['states/AbstractListState'];","import AbstractListState from 'flamarkt/backoffice/common/states/AbstractListState';\nimport File from '../../common/models/File';\n\nexport default class FileListState extends AbstractListState<File> {\n    type() {\n        return 'flamarkt/files';\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-backoffice']||{})['backoffice']||{})['components/AbstractList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","import AbstractList from 'flamarkt/backoffice/backoffice/components/AbstractList';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport Button from 'flarum/common/components/Button';\nimport File from '../../common/models/File';\n\nexport default class FileList extends AbstractList<File> {\n    head() {\n        const columns = super.head();\n\n        columns.add('thumbnail', m('th', app.translator.trans('flamarkt-library.backoffice.files.head.thumbnail')), 20);\n        columns.add('title', m('th', app.translator.trans('flamarkt-library.backoffice.files.head.title')), 10);\n\n        return columns;\n    }\n\n    columns(file: File) {\n        const columns = super.columns(file);\n\n        columns.add('thumbnail', m('td', m('img', {\n            src: file.conversionUrl('150x150'),\n            alt: file.title(),\n        })), 20);\n        columns.add('title', m('td', file.title()), 10);\n\n        return columns;\n    }\n\n    actions(file: File) {\n        const actions = super.actions(file);\n\n        actions.add('edit', LinkButton.component({\n            className: 'Button Button--icon',\n            icon: 'fas fa-pen',\n            href: app.route('files.show', {\n                id: file.id(),\n            }),\n        }));\n\n        actions.add('hide', Button.component({\n            className: 'Button Button--icon',\n            icon: 'fas fa-times',\n        }));\n\n        return actions;\n    }\n}\n","import Page from 'flarum/common/components/Page';\nimport FileListState from '../states/FileListState';\nimport FileList from '../components/FileList';\n\nexport default class FileIndexPage extends Page {\n    listState!: FileListState;\n    uploading: boolean = false;\n\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.listState = new FileListState();\n        this.listState.refresh();\n    }\n\n    view() {\n        return m('.FileIndexPage', m('.container', [\n            m('input', {\n                type: 'file',\n                onchange: event => {\n                    const body = new FormData();\n\n                    body.append('file', event.target.files[0]);\n\n                    this.uploading = true;\n                    m.redraw();\n\n                    app.request({\n                        method: 'POST',\n                        url: app.forum.attribute('apiUrl') + '/flamarkt/files',\n                        serialize: raw => raw,\n                        body,\n                    }).then(result => {\n                        this.uploading = false;\n                        this.listState.add(app.store.pushPayload(result));\n                        m.redraw();\n                    }).catch(err => {\n                        this.uploading = false;\n                        m.redraw();\n                        throw err;\n                    });\n                }\n            }),\n            m(FileList, {\n                state: this.listState,\n            }),\n        ]));\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-backoffice']||{})['common']||{})['pages/AbstractShowPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-backoffice']||{})['backoffice']||{})['components/SubmitButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","import AbstractShowPage from 'flamarkt/backoffice/common/pages/AbstractShowPage';\nimport SubmitButton from 'flamarkt/backoffice/backoffice/components/SubmitButton';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport File from '../../common/models/File';\n\nexport default class FileShowPage extends AbstractShowPage {\n    file: File | null = null;\n    dirty: boolean = false;\n    saving: boolean = false;\n    title: string = '';\n    description: string = '';\n\n    findType() {\n        return 'flamarkt/files';\n    }\n\n    show(file: File) {\n        this.file = file;\n        this.title = file.title() || '';\n        this.description = file.description() || '';\n\n        app.setTitle(file.title());\n        app.setTitleCount(0);\n    }\n\n    view() {\n        if (!this.file) {\n            return LoadingIndicator.component();\n        }\n\n        return m('form.FileShowPage', {\n            onsubmit: this.onsubmit.bind(this),\n        }, m('.container', [\n            m('.Form-group', [\n                m('label', app.translator.trans('flamarkt-library.backoffice.files.field.title')),\n                m('input.FormControl', {\n                    type: 'text',\n                    value: this.title,\n                    oninput: event => {\n                        this.title = event.target.value;\n                        this.dirty = true;\n                    },\n                }),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans('flamarkt-library.backoffice.files.field.description')),\n                m('textarea.FormControl', {\n                    value: this.description,\n                    oninput: event => {\n                        this.description = event.target.value;\n                        this.dirty = true;\n                    },\n                }),\n            ]),\n            m('.Form-group', [\n                SubmitButton.component({\n                    loading: this.saving,\n                    dirty: this.dirty,\n                    exists: this.file.exists,\n                }),\n            ]),\n        ]));\n    }\n\n    data() {\n        return {\n            title: this.title,\n            description: this.description,\n        };\n    }\n\n    onsubmit(event: Event) {\n        event.preventDefault();\n\n        this.saving = true;\n\n        // @ts-ignore\n        this.file.save(this.data()).then(file => {\n            this.file = file;\n\n            this.saving = false;\n            this.dirty = false;\n            m.redraw();\n        }).catch(error => {\n            this.saving = false;\n            m.redraw();\n        });\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","import FileList from './FileList';\nimport File from '../../common/models/File';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\n\nexport default class FileSelectList extends FileList {\n    actions(file: File) {\n        const actions = new ItemList();\n\n        actions.add('select', Button.component({\n            className: 'Button',\n            icon: 'fas fa-check',\n            onclick: () => {\n                this.attrs.onselect(file);\n            },\n        }, 'Select'));\n\n        return actions;\n    }\n}\n","import Modal, {IInternalModalAttrs} from 'flarum/common/components/Modal';\nimport FileListState from '../states/FileListState';\nimport FileSelectList from './FileSelectList';\nimport File from '../../common/models/File';\n\ninterface FileSelectionModalAttrs extends IInternalModalAttrs {\n    onselect: (file: File) => void\n}\n\nexport default class FileSelectionModal extends Modal<FileSelectionModalAttrs> {\n    listState!: FileListState\n\n    oninit(vnode: any) {\n        super.oninit(vnode);\n\n        this.listState = new FileListState();\n        this.listState.refresh();\n    }\n\n    className() {\n        return 'FlamarktLibrarySelectionModal';\n    }\n\n    title() {\n        return app.translator.trans('flamarkt-library.backoffice.select.title');\n    }\n\n    content() {\n        return m('.Modal-body', m(FileSelectList, {\n            state: this.listState,\n            onselect: (file: File) => {\n                this.attrs.onselect(file);\n                this.hide();\n            },\n        }));\n    }\n}\n","import File from '../common/models/File';\nimport BackofficeNav from 'flamarkt/backoffice/backoffice/components/BackofficeNav';\nimport ActiveLinkButton from 'flamarkt/backoffice/common/components/ActiveLinkButton';\nimport ProductList from 'flamarkt/core/backoffice/components/ProductList';\nimport ProductShowPage from 'flamarkt/core/backoffice/pages/ProductShowPage';\nimport Product from 'flamarkt/core/common/models/Product';\nimport {extend} from 'flarum/common/extend';\nimport Button from 'flarum/common/components/Button';\nimport FileIndexPage from './pages/FileIndexPage';\nimport FileShowPage from './pages/FileShowPage';\nimport FileSelectionModal from './components/FileSelectionModal';\nimport Model from 'flarum/common/Model';\n\napp.initializers.add('flamarkt-library', () => {\n    app.store.models['flamarkt-files'] = File;\n\n    Product.prototype.thumbnail = Model.hasOne('thumbnail');\n\n    app.routes['files.index'] = {\n        path: '/files',\n        component: FileIndexPage,\n    };\n    app.routes['files.show'] = {\n        path: '/files/:id',\n        component: FileShowPage,\n    };\n\n    extend(BackofficeNav.prototype, 'items', function (items) {\n        items.add('library', ActiveLinkButton.component({\n            href: app.route('files.index'),\n            icon: 'fas fa-file',\n            activeRoutes: [\n                'files.*',\n            ],\n        }, 'Library'));\n    });\n\n    extend(ProductList.prototype, 'head', function (columns) {\n        columns.add('thumbnail', m('th', 'Thumbnail'), 30);\n    });\n\n    extend(ProductList.prototype, 'columns', function (columns, product) {\n        const file = product.thumbnail();\n\n        columns.add('thumbnail', m('td', file ? m('img', {\n            src: file.conversionUrl('150x150'),\n            alt: product.title(),\n        }) : null), 30);\n    });\n\n    extend(ProductShowPage.prototype, 'oninit', function () {\n        this.thumbnail = null;\n    });\n\n    extend(ProductShowPage.prototype, 'show', function (returnValue, product) {\n        this.thumbnail = product.thumbnail() || null;\n    });\n\n    extend(ProductShowPage.prototype, 'fields', function (fields) {\n        fields.add('thumbnail', m('.Form-group', [\n            m('label', 'Thumbnail'),\n            this.thumbnail ? [\n                m('img', {\n                    src: this.thumbnail.conversionUrl('150x150'),\n                }),\n                Button.component({\n                    className: 'Button',\n                    icon: 'fas fa-times',\n                    onclick: () => {\n                        this.thumbnail = null;\n                        this.dirty = true;\n                    },\n                }, 'Remove'),\n            ] : null,\n            Button.component({\n                className: 'Button',\n                icon: 'fas fa-file',\n                onclick: () => {\n                    app.modal.show(FileSelectionModal, {\n                        onselect: file => {\n                            this.thumbnail = file;\n                            this.dirty = true;\n                        },\n                    });\n                },\n            }, 'Choose'),\n        ]));\n    });\n\n    extend(ProductShowPage.prototype, 'data', function (data) {\n        data.relationships = data.relationships || {};\n        data.relationships.thumbnail = this.thumbnail;\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","flarum","core","compat","File","conversions","Model","title","description","conversionUrl","name","this","keys","apiEndpoint","exists","data","id","extensions","FileListState","type","AbstractListState","FileList","head","columns","add","m","app","translator","trans","file","src","alt","actions","LinkButton","className","icon","href","route","Button","AbstractList","FileIndexPage","listState","uploading","oninit","vnode","refresh","view","onchange","event","body","FormData","append","target","files","redraw","request","method","url","forum","attribute","serialize","raw","then","result","store","pushPayload","err","state","Page","FileShowPage","dirty","saving","findType","show","setTitle","setTitleCount","onsubmit","oninput","SubmitButton","loading","LoadingIndicator","preventDefault","save","error","AbstractShowPage","FileSelectList","ItemList","onclick","attrs","onselect","FileSelectionModal","content","hide","Modal","initializers","models","Product","routes","path","component","extend","BackofficeNav","items","ActiveLinkButton","activeRoutes","ProductList","product","thumbnail","ProductShowPage","returnValue","fields","modal","relationships"],"sourceRoot":""}